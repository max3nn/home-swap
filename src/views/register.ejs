<!-- Registration Section -->
<section class="register-section" style="padding: 80px 0; min-height: calc(100vh - 64px - 200px);">
    <div class="container">
        <div class="row">
            <div class="col s12 m8 offset-m2 l6 offset-l3">
                <div class="register-card" style="background-color: hsl(var(--card)); border: 1px solid hsl(var(--border)); border-radius: var(--radius); padding: 48px 40px; box-shadow: 0 4px 16px rgba(0,0,0,0.04);">
                    <div class="center" style="margin-bottom: 32px;">
                        <div style="width: 64px; height: 64px; border-radius: 50%; background-color: hsl(var(--primary)); color: hsl(var(--primary-foreground)); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                            <i class="material-icons" style="font-size: 32px;">person_add</i>
                        </div>
                        <h2 style="font-size: 2rem; font-weight: 700; color: hsl(var(--foreground)); margin-bottom: 8px;">Create Your Account</h2>
                        <p style="color: hsl(var(--muted-foreground)); font-size: 1rem;">Join the Home Swap community today</p>
                    </div>

                    <!-- Success Message -->
                    <div id="success-message" class="success-message" style="display: none; background-color: #4caf50; color: white; padding: 16px 20px; border-radius: var(--radius); margin-bottom: 24px; align-items: center;">
                        <i class="material-icons" style="margin-right: 12px;">check_circle</i>
                        <span id="success-text"></span>
                    </div>

                    <!-- Error Message -->
                    <div id="error-message" class="error-message" style="display: none; background-color: #f44336; color: white; padding: 16px 20px; border-radius: var(--radius); margin-bottom: 24px; align-items: center;">
                        <i class="material-icons" style="margin-right: 12px;">error</i>
                        <span id="error-text"></span>
                    </div>

                    <form id="register-form">
                        <div class="input-field">
                            <i class="material-icons prefix" style="color: hsl(var(--muted-foreground));">person</i>
                            <input id="name" name="name" type="text" class="validate" required>
                            <label for="name">Full Name</label>
                            <span class="helper-text" data-error="Please enter your name"></span>
                        </div>

                        <div class="input-field">
                            <i class="material-icons prefix" style="color: hsl(var(--muted-foreground));">email</i>
                            <input id="email" name="email" type="email" class="validate" required>
                            <label for="email">Email Address</label>
                            <span class="helper-text" data-error="Please enter a valid email"></span>
                        </div>

                        <div class="input-field">
                            <i class="material-icons prefix" style="color: hsl(var(--muted-foreground));">lock</i>
                            <input id="password" name="password" type="password" class="validate" required minlength="6">
                            <label for="password">Password</label>
                            <span class="helper-text" data-error="Password must be at least 6 characters"></span>
                        </div>

                        <button type="submit" class="btn-primary waves-effect waves-light" style="width: 100%; margin-top: 24px; height: 48px; line-height: 48px;">
                            Create Account
                            <i class="material-icons right" style="line-height: inherit;">arrow_forward</i>
                        </button>
                    </form>

                    <div class="center" style="margin-top: 32px;">
                        <p style="color: hsl(var(--muted-foreground)); font-size: 0.9rem;">
                            Already have an account? 
                            <a href="#login" style="color: hsl(var(--primary)); font-weight: 500;">Sign in</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .register-section {
        background-color: hsl(var(--background));
    }

    .input-field {
        margin-bottom: 24px;
    }

    .input-field label {
        color: hsl(var(--muted-foreground));
        font-size: 0.95rem;
    }

    .input-field input[type=text]:focus + label,
    .input-field input[type=email]:focus + label,
    .input-field input[type=password]:focus + label {
        color: hsl(var(--primary));
    }

    .input-field input[type=text]:focus,
    .input-field input[type=email]:focus,
    .input-field input[type=password]:focus {
        border-bottom: 2px solid hsl(var(--primary));
        box-shadow: 0 1px 0 0 hsl(var(--primary));
    }

    .input-field input[type=text].valid,
    .input-field input[type=email].valid,
    .input-field input[type=password].valid {
        border-bottom: 2px solid #4caf50;
        box-shadow: 0 1px 0 0 #4caf50;
    }

    .input-field input[type=text].invalid,
    .input-field input[type=email].invalid,
    .input-field input[type=password].invalid {
        border-bottom: 2px solid #f44336;
        box-shadow: 0 1px 0 0 #f44336;
    }

    .success-message {
        animation: slideDown 0.3s ease-out;
    }

    .error-message {
        animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .btn-primary:disabled {
        background-color: hsl(var(--muted-foreground));
        cursor: not-allowed;
        opacity: 0.6;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('register-form');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const successText = document.getElementById('success-text');
        const errorText = document.getElementById('error-text');
        const submitButton = form.querySelector('button[type="submit"]');

        // Initialize Materialize form validation
        M.updateTextFields();

        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // Hide previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';

            // Get form data
            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value
            };

            // Validate form
            if (!formData.name || !formData.email || !formData.password) {
                showError('Please fill in all fields');
                return;
            }

            if (formData.password.length < 6) {
                showError('Password must be at least 6 characters long');
                return;
            }

            // Disable submit button
            submitButton.disabled = true;
            submitButton.innerHTML = 'Creating Account... <i class="material-icons right" style="line-height: inherit;">hourglass_empty</i>';

            try {
                const response = await fetch('/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // Check if response is ok and has content
                let data;
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    try {
                        data = await response.json();
                    } catch (jsonError) {
                        console.error('Failed to parse JSON response:', jsonError);
                        showError('Server returned an invalid response. Please try again.');
                        return;
                    }
                } else {
                    // If response is not JSON, get text
                    const text = await response.text();
                    console.error('Non-JSON response:', text);
                    showError('Server error. Please try again later.');
                    return;
                }

                if (response.ok && data.success) {
                    // Show success message
                    successText.textContent = data.message || 'Account registered successfully!';
                    successMessage.style.display = 'flex';
                    
                    // Reset form
                    form.reset();
                    M.updateTextFields();

                    // Scroll to success message
                    successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

                    // Redirect after 2 seconds
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    // Show error message
                    showError(data.message || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                showError('Network error. Please check your connection and try again.');
            } finally {
                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.innerHTML = 'Create Account <i class="material-icons right" style="line-height: inherit;">arrow_forward</i>';
            }
        });

        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    });
</script>

